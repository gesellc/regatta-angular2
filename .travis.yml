sudo: required
dist: trusty

language: python

python:
  - "3.4"
  - "3.5"

install:
  - travis_retry pip install -r backend/requirements.txt
  - travis_retry pip install coveralls
  - travis_retry pip install flake8
  - npm install -g dart-up
  - npm install -g protractor
  - webdriver-manager update
  - npm install -g jasmine-spec-reporter --save-dev


before_script:
  - (cd backend && python3 manage.py migrate)
  - (cd backend && python setup.py flake8)
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - (cd backend && python3 manage.py runserver > django-server.log 2>&1 &)
  - (cd frontend && pub get)
  - (cd frontend && pub serve > angular-server.log 2>&1 &)
  - (cd e2e_tests && webdriver-manager start > webdriver.log 2>&1 &)

script:
  - (cd backend && coverage run setup.py test)
  - (cd e2e_tests && protractor conf.js)

after_success:
  - (cd backend && coveralls)

after_script:
  - (cd backend && cat django-server.log)
  - (cd frontend && cat angular-server.log)
  - (cd e2e_tests && cat webdriver.log)
